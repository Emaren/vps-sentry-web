# Copy to .vps.env and adjust values for your server.
VPS_HOST=hetzner-codex
VPS_APP_DIR=/path/to/your/repo/on/vps

# Use one restart/logging mode:
# 1) systemd service
VPS_SERVICE=vps-sentry-web.service

# 2) pm2 app (leave commented if using systemd)
# VPS_PM2_APP=vps-sentry-web

# Optional: force deploy branch/ref (example: v1.0, main, release/2026-02)
# If unset, script uses upstream branch or origin/<current>.
# VPS_GIT_REF=v1.0

# DB provider used at deploy time to generate Prisma client
# sqlite (default) or postgres
VPS_DB_PROVIDER=sqlite
# During Postgres cutover, switch to postgres after parity/acceptance checks pass.
# Run Prisma migrations during deploy (1=on, 0=off)
VPS_RUN_DB_MIGRATIONS=1

# Deploy safety:
# - abort (default): fail if VPS repo has local-only commits
# - reset: create backup/<timestamp> on VPS then hard-reset to origin/<ref>
VPS_DEPLOY_STRATEGY=abort

# Require a clean local git tree before deploy (1=on, 0=off)
VPS_REQUIRE_CLEAN_LOCAL=1

# If VPS_GIT_REF is set, require local HEAD to be present on origin/<ref> (1=on, 0=off)
VPS_REQUIRE_PUSHED_REF=1

# Require passwordless sudo for systemd restart/log commands (1=on, 0=off)
# Keep enabled for zero-interactive deploys.
VPS_REQUIRE_NONINTERACTIVE_SUDO=1

# Optional: number of log lines for `make logs`
VPS_LOG_LINES=150

# SSH reliability knobs (seconds / attempts)
VPS_SSH_CONNECT_TIMEOUT=10
VPS_SSH_CONNECTION_ATTEMPTS=2
VPS_SSH_SERVER_ALIVE_INTERVAL=15
VPS_SSH_SERVER_ALIVE_COUNT_MAX=3
VPS_SSH_RETRIES=4
VPS_SSH_RETRY_DELAY_SECONDS=5
# SSH stability guardrail (detects burst SSH refusal / OpenSSH LIMIT regressions)
VPS_SSH_STABILITY_PROBES=6
VPS_SSH_STABILITY_INTERVAL_SECONDS=1
VPS_SSH_STABILITY_MAX_FAILURES=0
# Set to 1 only if you require `sudo -n ufw status` visibility as a hard condition.
VPS_SSH_STABILITY_FAIL_ON_UFW_UNKNOWN=0
# Doctor defaults: include stability guardrail and fail when it detects instability.
VPS_DOCTOR_INCLUDE_SSH_STABILITY=1
VPS_DOCTOR_FAIL_ON_SSH_STABILITY=1

# Production monitor thresholds
VPS_WEB_PORT=3035
VPS_MONITOR_DISK_WARN_PCT=85
VPS_MONITOR_BACKUP_MAX_AGE_HOURS=26
VPS_MONITOR_CHECK_BACKUP=1

# Backup + restore drill
VPS_BACKUP_BASE=/home/tony/_backup/vps-sentry-web
VPS_BACKUP_KEEP_DAYS=14
VPS_SQLITE_DB_PATH=/var/lib/vps-sentry-web/prod.db
# Optional: set when production is Postgres and pg_dump is available on VPS
# VPS_POSTGRES_DATABASE_URL=postgresql://user:pass@127.0.0.1:5432/vps_sentry_web?schema=public
# Optional: dedicated drill DB URL used by scripts/vps-restore-drill.sh
# VPS_RESTORE_DRILL_POSTGRES_URL=postgresql://user:pass@127.0.0.1:5432/vps_sentry_web_restore_drill?schema=public
VPS_RESTORE_DRILL_REQUIRE_POSTGRES=0
VPS_RESTORE_DRILL_REQUIRE_SQLITE=0

# Alert delivery (used by scripts/vps-alert.sh and vps-monitor --alert)
# Split multiple webhooks by comma, newline, or ||
# VPS_ALERT_WEBHOOK_URLS=https://hooks.example/a,https://hooks.example/b
# VPS_ALERT_EMAIL_TO=ops@example.com
# VPS_ALERT_EMAIL_FROM=vps-sentry@example.com
VPS_ALERT_SUBJECT_PREFIX='[VPS Sentry]'
VPS_ALERT_CURL_TIMEOUT_SECONDS=10
VPS_ALERT_DEFAULT_ROUTE=both
VPS_ALERT_ROUTE_INFO=webhook
VPS_ALERT_ROUTE_WARN=both
VPS_ALERT_ROUTE_CRITICAL=both

# Step 15 SLO / burn-rate checks
VPS_SLO_BASE_URL=http://127.0.0.1:3035
VPS_SLO_ENDPOINT_PATH=/api/ops/slo
# Optional shared token for non-interactive SLO automation calls.
# Set the same value in server runtime env (for /api/ops/slo):
# VPS_SLO_TOKEN=replace-with-long-random-secret
# Allow non-interactive loopback probes from the VPS host itself (default on).
# Keep enabled unless you explicitly require token-only SLO polling.
VPS_SLO_ALLOW_LOOPBACK_PROBE=1
VPS_SLO_WINDOW_HOURS=24
VPS_SLO_BURN_SHORT_WINDOW_MINUTES=5
VPS_SLO_BURN_LONG_WINDOW_MINUTES=60
VPS_SLO_BURN_WARN=6
VPS_SLO_BURN_CRITICAL=14
VPS_SLO_AVAILABILITY_TARGET_PCT=99.9
VPS_SLO_NOTIFY_DELIVERY_TARGET_PCT=99
VPS_SLO_INGEST_FRESH_TARGET_PCT=99
VPS_SLO_MTTD_TARGET_MINUTES=5
VPS_SLO_MTTR_TARGET_MINUTES=60
VPS_SLO_ROUTE_WARN=both
VPS_SLO_ROUTE_CRITICAL=both
VPS_SLO_ALERT_ON_WARN=1
VPS_SLO_ALERT_ON_CRITICAL=1
VPS_SLO_ALERT_ON_OK=0

# Backup automation (cron on VPS)
VPS_BACKUP_CRON='17 * * * *'
VPS_BACKUP_LOG_PATH=/home/tony/vps-sentry-backup.log
VPS_BACKUP_REPORT_AFTER_RUN=1

# Step 16 recovery automation + objective reporting
VPS_RESTORE_DRILL_CRON='23 3 * * 1'
VPS_RESTORE_DRILL_LOG_PATH=/home/tony/vps-sentry-restore-drill.log
VPS_RESTORE_DRILL_HISTORY_FILE=/home/tony/_backup/vps-sentry-web/restore-drill-history.log
VPS_RPO_TARGET_MINUTES=60
VPS_RTO_TARGET_MINUTES=15
VPS_RESTORE_DRILL_MAX_AGE_HOURS=192

# Step 7 remediation queue + safety
VPS_REMEDIATE_MAX_QUEUE_PER_HOST=4
VPS_REMEDIATE_MAX_QUEUE_TOTAL=200
VPS_REMEDIATE_QUEUE_TTL_MINUTES=120
VPS_REMEDIATE_MAX_RETRY_ATTEMPTS=3
VPS_REMEDIATE_RETRY_BACKOFF_SECONDS=15
VPS_REMEDIATE_RETRY_BACKOFF_MAX_SECONDS=900
VPS_REMEDIATE_COMMAND_TIMEOUT_MS=20000
VPS_REMEDIATE_MAX_BUFFER_BYTES=512000
VPS_REMEDIATE_QUEUE_AUTODRAIN=1
# Optional token for server-side queue drain endpoint (/api/ops/remediate-drain)
# VPS_REMEDIATE_QUEUE_TOKEN=replace-with-long-random-secret

# Step 18 autonomous remediation tiers + approval/canary/rollback gates
VPS_REMEDIATE_AUTONOMOUS_ENABLED=1
# observe | safe_auto | guarded_auto | risky_manual
VPS_REMEDIATE_AUTONOMOUS_MAX_TIER=guarded_auto
VPS_REMEDIATE_AUTONOMOUS_MAX_QUEUED_PER_CYCLE=2
VPS_REMEDIATE_AUTONOMOUS_MAX_QUEUED_PER_HOUR=20
# none | low | medium | high (>= threshold requires approval)
VPS_REMEDIATE_APPROVAL_RISK_THRESHOLD=medium
VPS_REMEDIATE_CANARY_ROLLOUT_PERCENT=25
VPS_REMEDIATE_CANARY_REQUIRE_CHECKS=1
VPS_REMEDIATE_AUTO_ROLLBACK=1

# Step 19 fleet rollout + blast-radius safeguards
VPS_REMEDIATE_FLEET_MAX_HOSTS=12
VPS_REMEDIATE_FLEET_MAX_PER_GROUP=5
VPS_REMEDIATE_FLEET_MAX_PERCENT_ENABLED=40
VPS_REMEDIATE_FLEET_DEFAULT_STAGE_SIZE=3
VPS_REMEDIATE_FLEET_REQUIRE_SELECTOR=1
VPS_REMEDIATE_FLEET_POLICY_MAX_HOST_UPDATES=60

# Step 11 durable ops worker runtime (scripts/ops-worker.mjs)
OPS_WORKER_BASE_URL=http://127.0.0.1:3035
OPS_WORKER_DRAIN_LIMIT=5
OPS_WORKER_INTERVAL_SECONDS=15
OPS_WORKER_IDLE_INTERVAL_SECONDS=30
OPS_WORKER_MAX_BACKOFF_SECONDS=120
# OPS_WORKER_TOKEN=replace-with-long-random-secret

# Step 8 status API micro-cache (milliseconds, 0 disables)
VPS_STATUS_CACHE_TTL_MS=1200

# Step 14 observability in-memory ring buffers (server process local)
VPS_OBS_MAX_LOGS=500
VPS_OBS_MAX_TRACES=500
VPS_OBS_MAX_ALERTS=300

# Step 17 incident workflow engine v2 timers + automation
VPS_INCIDENT_ACK_MINUTES_CRITICAL=5
VPS_INCIDENT_ACK_MINUTES_HIGH=15
VPS_INCIDENT_ACK_MINUTES_MEDIUM=30
VPS_INCIDENT_ESCALATE_EVERY_MINUTES_CRITICAL=10
VPS_INCIDENT_ESCALATE_EVERY_MINUTES_HIGH=20
VPS_INCIDENT_ESCALATE_EVERY_MINUTES_MEDIUM=45
# Optional token for non-interactive escalation sweeps:
# POST /api/ops/incidents/escalate with header x-incident-escalate-token
# VPS_INCIDENT_ESCALATE_TOKEN=replace-with-long-random-secret

# Step 20 supply-chain + chaos certification + readiness scorecard
VPS_SUPPLYCHAIN_MAX_CRITICAL=0
VPS_SUPPLYCHAIN_MAX_HIGH=1
VPS_SUPPLYCHAIN_MAX_MODERATE=25
VPS_SUPPLYCHAIN_FAIL_UNKNOWN_LICENSE=0
VPS_SUPPLYCHAIN_DENY_LICENSE_REGEX='(^|[^A-Za-z])(AGPL|GPL-3\.0|SSPL|BUSL)([^A-Za-z]|$)'
VPS_SUPPLYCHAIN_ARTIFACT_DIR=/Users/tonyblum/projects/vps-sentry-web/.artifacts/supply-chain
VPS_CHAOS_MAX_RECOVERY_SECONDS=120
VPS_CHAOS_POLL_INTERVAL_SECONDS=2
VPS_CHAOS_PERF_REQUESTS=120
VPS_CHAOS_PERF_CONCURRENCY=20
VPS_CHAOS_REQUIRE_PERF_PASS=1
VPS_CHAOS_ARTIFACT_DIR=/Users/tonyblum/projects/vps-sentry-web/.artifacts/chaos
VPS_SCORECARD_MIN_PASS_PERCENT=85
VPS_SCORECARD_ARTIFACT_DIR=/Users/tonyblum/projects/vps-sentry-web/.artifacts/sentinel-prime
VPS_SCORECARD_CHECK_TIMEOUT_SECONDS=240
# Retries optional checks that fail with transient SSH refusal/timeouts.
VPS_SCORECARD_SSH_FAILURE_RETRIES=2
VPS_SCORECARD_SSH_FAILURE_RETRY_DELAY_SECONDS=8
